DOCUMENTATION:
  author:
    - Doston Toirov (@dtoirov)
  short_description: Read events from pg_pub_sub.
  description:
    - An ansible-rulebook event source plugin for reading events from pg_pub_sub.
  version_added: '2.3.2'
  options:
    dsn:
      description:
        - The connection string/dsn for Postgres.
      type: str
    channels:
      description:
        - The list of channels to listen
      type: list
  notes:
    - Chunking - this is just informational, a user doesn't have to do anything
      special to enable chunking. The sender which is the pg_notify
      action from ansible rulebook will decide if chunking needs to
      happen based on the size of the payload.
      If the messages are over 7KB the sender will chunk the messages
      into separate payloads with each payload having having the following
      keys

      * _message_chunked_uuid   The unique message uuid
      * _message_chunk_count    The number of chunks for the message
      * _message_chunk_sequence The sequence of the current chunk
      * _chunk                  The actual chunk
      * _message_length         The total length of the message
      * _message_xx_hash        A hash for the entire message

      The pg_listener source will assemble the chunks and once all the
      chunks have been received it will deliver the entire payload to the
      rulebook engine. Before the payload is delivered we validated that the entire
      message has been received by validate its computed hash.

EXAMPLES:
  - ansible.eda.pg_listener:
      dsn: "host=localhost port=5432 dbname=mydb"
      channels:
        - my_events
        - my_alerts
